config:
    name: 购车认证－"待完成购车认证" 订单进行购车认证 testcases/order/pay_beforehand/purchase_certification.yml
    variables:
#        phoneNum: 16621368448
#        IDNum: 350182199203253384
#        cardNo: 6212261402000859782
        name: '汤露露'
        order_status: '待购车认证'
        phoneNum: '15012340003'
        IDNum: '350581198012281017'
        cardNo: '6217000490000315744'
        carFullName: 'AutoTestCarBrandAaddCar'

teststeps:
#  - name: 添加客户  testcases/usercenter/add_customer.yml
#    testcase: testcases/usercenter/add_customer.yml
#    validate:
#      - eq: [status_code,200]
#
#  - name: 获取验证码 api/account/GET_VeriCode.yml
#    api: api/account/GET_VeriCode.yml
#    variables:
#      phoneNum: $phoneNum
#    validate:
#      - eq: [status_code,200]
#
#  - name: 添加客户  api/usercenter/credit/custom-check/POST_Universal.yml
#    api: api/usercenter/credit/custom-check/POST_Universal.yml
#    variables:
#      phoneNum: $phoneNum
#      IDNum: $IDNum
#      name: $name
#    validate:
#      - eq: [status_code,200]

  - name: 获取客户列表  api/usercenter/users/POST_Customer.yml
    api: api/usercenter/users/POST_Customer.yml
    variables:
        queryName: ${phoneNum}
    validate:
      - eq: [status_code,200]

  - name: 添加待售车辆  testcases/supply/skipIf_create_car.yml
    testcase: testcases/supply/skipIf_create_car.yml
    validate:
      - eq: [status_code,200]

  - name: 获取待售车辆  api/supplychain/GET_UnlockedCars.yml
    api: api/supplychain/GET_UnlockedCars.yml
    variables:
      carTypeName: ${carFullName}
      isLocked: 0
      carStstus: 4
    validate:
      - eq: [status_code,200]
    extract:
      vin: content.0.vin
    output:
      - vin

  - name: 验证车辆状态:未锁车、待售  api/supplychain/GET_Cars.yml
    api: api/supplychain/GET_Cars.yml
    variables:
      vin: ${vin}
      carTypeName: ${carFullName}
    validate:
      - eq: [status_code,200]
      - eq: [content.0.locked, false]
      - eq: [content.0.sold, false]

  - name: 创建订单 testcases/order/create_order.yml
    testcase: testcases/order/create_order.yml
    variables:
        keyword: ${carFullName}
        phoneNum: $phoneNum
        order_status: $order_status
    validate:
      - eq: [status_code,200]

  - name: 获取订单号 api/mall/salesman/POST_Order.yml
    api: api/mall/salesman/POST_Order.yml
    variables:
      queryTradeNo: $phoneNum
    validate:
      - eq: [status_code,200]
    extract:
      - tradeNo: content.0.tradeNo
      - orderId: content.0.orderId

  - name: 验证库存：已锁车、待售  api/supplychain/GET_Cars.yml
    api: api/supplychain/GET_Cars.yml
    variables:
      vin: ${vin}
      carTypeName: ${carFullName}
    validate:
      - eq: [status_code,200]
      - eq: [content.0.locked, true]
      - eq: [content.0.sold, false]
      - eq: [content.0.tradeNo,$tradeNo]

  - name: 验证订单状态：待购车认证 api/mall/back-end/orders/POST_Params.yml
    api: api/mall/back-end/orders/POST_Params.yml
    variables:
      tradeNo: ${tradeNo}
      phoneNum: $phoneNum
    validate:
      - eq: [content.0.orderStatusDesc,"待购车认证"]
      - eq: [content.0.orderDetail.carItemStatus, 9]

  - name: 购车认证-跳过人脸认证 testcases/usercenter/purchase_certification.yml
    testcase: testcases/usercenter/purchase_certification.yml
    variables:
        phoneNum: ${phoneNum}
        customerId: ${get_value_from_tmp(userId)}
        cardNo: ${cardNo}
        name: ${name}
        IDNum: ${IDNum}
    validate:
      - eq: [status_code, 200]

  - name: 完善个人信息 testcases/usercenter/perfect_userInfo.yml
    testcase: testcases/usercenter/perfect_userInfo.yml
    variables:
      phoneNum: ${phoneNum}
    validate:
      - eq: [status_code, 200]

  - name: 信审账号登录  testcases/login/trial_account_login.yml
    testcase: testcases/login/trial_account_login.yml
    variables:
      name: $name
    validate:
      - eq: [status_code,200]
    setup_hooks:
      - ${sleep(120)}

  - name: 审核订单  testcases/order/audit_order.yml
    testcase: testcases/order/audit_order.yml
    variables:
      name: $name
    validate:
      - eq: [status_code,200]

  - name: 验证订单状态：订单处理中 api/mall/back-end/orders/POST_Params.yml
    api: api/mall/back-end/orders/POST_Params.yml
    variables:
      tradeNo: ${tradeNo}
      phoneNum: $phoneNum
    validate:
      - eq: [content.0.orderStatusDesc,"订单处理中"]
      - eq: [content.0.orderDetail.carItemStatus, 9]
    setup_hooks:
      - ${sleep(10)}

  - name: 完善还款信息 testcases/order/perfect_repayment_info.yml
    testcase: testcases/order/perfect_repayment_info.yml
    variables:
        queryTradeNo: $phoneNum
        name: $name
        phoneNum: $phoneNum
        queryName: $name
        cardNo: $cardNo
    validate:
      - eq: [status_code, 200]

  - name: 搜索订单，验证订单状态：待签署合同 api/mall/back-end/orders/POST_Params.yml
    api: api/mall/back-end/orders/POST_Params.yml
    variables:
      tradeNo: ${tradeNo}
      phoneNum: $phoneNum
    validate:
      - eq: [content.0.orderStatusDesc,"待签署合同"]
      - eq: [content.0.orderDetail.carItemStatus, 9]

  - name: 签署合同  testcases/contracts/sign_contract.yml
    testcase: testcases/contracts/sign_contract.yml
    variables:
      phoneNum: $phoneNum
      cardNo: $cardNo
      orderId: $orderId
    validate:
      - eq: [status_code,200]

  - name: 验证订单状态：待确认提车 api/mall/back-end/orders/POST_Params.yml
    api: api/mall/back-end/orders/POST_Params.yml
    variables:
      tradeNo: ${tradeNo}
      phoneNum: $phoneNum
    validate:
      - eq: [content.0.orderStatusDesc,"待确认提车"]

  - name: 提车 testcases/order/mention_car.yml
    testcase: testcases/order/mention_car.yml
    variables:
        queryTradeNo: $phoneNum
        queryName: $name
        orderId: $orderId
    validate:
      - eq: [status_code,200]

  - name: 验证订单状态：交易完成 api/mall/back-end/orders/POST_Params.yml
    api: api/mall/back-end/orders/POST_Params.yml
    variables:
      tradeNo: ${tradeNo}
      phoneNum: $phoneNum
    validate:
      - eq: [content.0.orderStatusDesc,"交易完成"]
      - eq: [content.0.orderDetail.carItemStatus, 99]

  - name: 验证库存：已锁车、售出  api/supplychain/GET_Cars.yml
    api: api/supplychain/GET_Cars.yml
    variables:
      vin: ${vin}
      carTypeName: ${carFullName}
    validate:
      - eq: [status_code,200]
      - eq: [content.0.locked, true]
      - eq: [content.0.sold, true]
      - eq: [content.0.tradeNo,$tradeNo]
    teardown_hooks:
      - ${run_audit_order()}