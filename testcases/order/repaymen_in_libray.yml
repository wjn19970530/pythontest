config:
      name: 完善还款信息(在库) testcases/order/repaymen_in_libray.yml
      variables:
        carTypeName: "AutoTestCarBrandLibrary1S"
        orderstatustimeout: ${get_config(orderstatustimeout)}
        environment: ${ENV(environment)}
teststeps:
-   name: 新建在库车辆 testcases/supply/create_in_library_car.yml
    testcase: testcases/supply/create_in_library_car.yml
    validate:
      - eq: [status_code, 200]
    setup_hooks:
      - ${run_audit_order()}
      - ${run_get_user_message()}

-   name: 获取待售未锁车辆列表 api/supplychain/Get_Cars_ condition.yml
    api: api/supplychain/Get_Cars_ condition.yml
    variables:
      carTypeName: $carTypeName
      carStatus: 3
    validate:
      - eq: [status_code, 200]
    extract:
      - vin: content.0.vin

-   name: 创建在库车辆订单并提交 testcases/order/create_order_in_library.yml
    testcase: testcases/order/create_order_in_library.yml
    variables:
      keyword1: $carTypeName
    validate:
      - eq: [status_code, 200]

-   name: 获取订单号 api/mall/salesman/POST_Order.yml
    api: api/mall/salesman/POST_Order.yml
    validate:
      - eq: [status_code,200]
    extract:
      - orderId: content.0.orderId
      - tradeNo: content.0.tradeNo


-   name: 验证库存：未锁车、代采购  api/supplychain/GET_Cars.yml
    api: api/supplychain/GET_Cars.yml
    variables:
       vin: ${vin}
       carTypeName: $carTypeName
    validate:
      - eq: [status_code,200]
      - eq: [content.0.locked, false]
      - eq: [content.0.sold, false]


-   name: 验证订单状态：等待审核 api/mall/back-end/orders/POST_Params.yml
    api: api/mall/back-end/orders/POST_Params.yml
    variables:
      tradeNo: ${tradeNo}
    validate:
      - eq: [content.0.orderStatusDesc,"等待审核"]
      - eq: [content.0.orderDetail.carItemStatus, 8]

-   name: 信审账号登录  testcases/login/trial_account_login.yml
    testcase: testcases/login/trial_account_login.yml
    validate:
      - eq: [status_code,200]
    setup_hooks:
      - ${sleep(60)}
      - ${get_audit_list()}

-   name: 审核订单  testcases/order/audit_order.yml
    testcase: testcases/order/audit_order.yml
    validate:
      - eq: [status_code, 200]
    teardown_hooks:
      - ${order_status_change_time($orderstatustimeout,$environment)}

-   name: 验证订单状态：订单处理中 api/mall/back-end/orders/POST_Params.yml
    api: api/mall/back-end/orders/POST_Params.yml
    variables:
        tradeNo: ${tradeNo}
    validate:
      - eq: [content.0.orderStatusDesc,"订单处理中"]
      - eq: [content.0.orderDetail.carItemStatus, 8]

-   name: 完善还款信息  api/mall/mallSignAgreementInfo/anybank/POST_Sign.yml
    api: api/mall/mallSignAgreementInfo/anybank/POST_Sign.yml
    variables:
        orderId: $orderId
    validate:
      - eq: [status_code,200]
    teardown_hooks:
      - ${sleep(10)}

-   name: 验证订单状态：订单处理中 api/mall/back-end/orders/POST_Params.yml
    api: api/mall/back-end/orders/POST_Params.yml
    variables:
        tradeNo: ${tradeNo}
    validate:
      - eq: [content.0.orderStatusDesc,"订单处理中"]
      - eq: [content.0.orderDetail.carItemStatus, 8]