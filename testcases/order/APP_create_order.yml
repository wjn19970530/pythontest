config:
    name: 创建待售车辆订单并提交  testcases/order/APP_create_order.yml
    variables:
      phoneNum: ${ENV(phoneNum)}
      verifyCode: ${ENV(verifyCode)}
      access_token: ${get_token(access_token)}
      keyword: ''
      orderPayType: 1
      order_status: 待支付
    base_url: ${ENV(base_url)}
    setup_hooks:
      - ${sql_init_order($phoneNum)}
      - ${sleep(5)}
    export:
      - orderId

teststeps:
-   name: 获取账户信息  api/account/GET_Account.yml
    api: api/account/GET_Account.yml
    validate:
      - eq: [status_code, 200]
    teardown_hooks:
      - ${save_seller_id_form_response($response)}

-   name: 获取车辆ID api/mall/car-items/POST_LeaseParams.yml
    api: api/mall/car-items/POST_LeaseParams.yml
    variables:
      keyword: ${keyword}
    validate:
      - eq: [status_code,200]
    teardown_hooks:
        - ${save_car_id_from_response($response,$keyword)}

-   name: 获取车辆详细信息  api/mall/car-items/GET_CarItemDetails.yml
    api: api/mall/car-items/GET_CarItemDetails.yml
    variables:
      carId: ${get_value_from_tmp(carId)}
    validate:
      - eq: [status_code,200]
    extract:
      - leasePlanId: content.carLeasePlanList.0.id
      - skuId: content.carItemSkuWrapperDTO.selectTrees.0.children.0.children.0.sku.skuId

-   name: 创建订单  api/mall/car-items/POST_SellerCreate.yml
    api: api/mall/car-items/POST_SellerCreate.yml
    variables:
        leasePlanId: ${leasePlanId}
        skuId: ${skuId}
        itemId: ${get_value_from_tmp(carId)}
#    extract:
#      orderId: content.orderId
#    validate:
#      - eq: [status_code, 200]
    teardown_hooks:
      - ${sleep(5)}
      - ${sleep(10)}

-   name: 获取订单号 api/mall/salesman/POST_Order.yml
    api: api/mall/salesman/POST_Order.yml
    validate:
      - eq: [status_code,200]
    extract:
      - tradeNo: content.0.tradeNo
      - orderId: content.0.orderId

-   name: 搜索订单，验证订单状态($order_status)  api/mall/back-end/orders/POST_Params.yml
    api: api/mall/back-end/orders/POST_Params.yml
    variables:
        tradeNo: ${tradeNo}
    validate:
      - eq: [content.0.orderStatusDesc,$order_status]
      - eq: [content.0.orderDetail.carItemStatus, 7]

-   name: 订单选择支付方式  api/mall/car-items/POST_ScanCodePayment.yml
    api: api/mall/car-items/POST_ScanCodePayment.yml
    variables:
      orderId: $orderId
      orderPayType: $orderPayType
    validate:
      - eq: [status_code, 200]

-   name: 上传支付图片  api/usercenter/aliyun/POST_OssImg.yml
    api: api/usercenter/aliyun/POST_OssImg.yml
    validate:
      - eq: [status_code, 200]
    extract:
      - ossUrl: content.ossUrl

-   name: 提交订单  api/mall/offline-payments/POST_Submit.yml
    api: api/mall/offline-payments/POST_Submit.yml
    variables:
      orderId: $orderId
      billImages: $ossUrl
      orderPayType: $orderPayType
    validate:
      - eq: [status_code, 200]
